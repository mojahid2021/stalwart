# ==============================================
# Stalwart Advanced Setup - Environment Variables Template
# ==============================================
# Copy this file to .env and fill in your secure passwords and domains
# This template includes ALL variables required for docker-compose.advanced.yml
# with nginx reverse proxy and separate admin/mail domains
#
# cp .env.template .env
# nano .env
# ==============================================

# ==============================================
# REQUIRED: Admin Credentials
# ==============================================
# Admin password for Stalwart web interface
# Access: https://admin.yourdomain.com (after nginx setup)
# Login: admin / YOUR_ADMIN_SECRET
# IMPORTANT: Change this to a strong, unique password!
# Generate with: openssl rand -base64 32
ADMIN_SECRET=<CHANGE_ME_TO_STRONG_PASSWORD>

# ==============================================
# REQUIRED: Domain Configuration
# ==============================================
# Mail services domain (SMTP, IMAP, POP3, ManageSieve)
# This domain will use Stalwart's built-in ACME for TLS
# Example: mail.yourdomain.com
MAIL_DOMAIN=<YOUR_MAIL_DOMAIN>

# Admin panel domain (accessed via nginx reverse proxy)
# This domain requires TLS certificates (certbot or manual)
# Example: admin.yourdomain.com
ADMIN_DOMAIN=<YOUR_ADMIN_DOMAIN>

# ==============================================
# Database Configuration
# ==============================================
# PostgreSQL database password
# Use a strong password with at least 20 characters
# Generate with: openssl rand -base64 32
DB_PASSWORD=<CHANGE_ME_TO_STRONG_PASSWORD>

# ==============================================
# Cache Configuration
# ==============================================
# Redis cache password
# Use a strong password with at least 20 characters
# Generate with: openssl rand -base64 32
REDIS_PASSWORD=<CHANGE_ME_TO_STRONG_PASSWORD>

# ==============================================
# Object Storage Configuration
# ==============================================
# MinIO S3-compatible storage credentials
MINIO_USER=minioadmin
# Use a strong password with at least 20 characters
# Generate with: openssl rand -base64 32
MINIO_PASSWORD=<CHANGE_ME_TO_STRONG_PASSWORD>

# ==============================================
# System Configuration
# ==============================================
# Timezone (use your local timezone)
# Examples: UTC, America/New_York, Europe/London, Asia/Tokyo
TZ=UTC

# ==============================================
# Resource Configuration (Dynamic Allocation)
# ==============================================
# By default, Docker uses resources dynamically based on need
# Only minimum reservations are set to guarantee availability
# No hard limits - containers can use more resources when needed

# Stalwart resource reservations (minimum guaranteed)
STALWART_MEMORY_RESERVATION=1G
STALWART_CPU_RESERVATION=1

# PostgreSQL resource reservations
POSTGRES_MEMORY_RESERVATION=512M
POSTGRES_CPU_RESERVATION=0.5

# Redis resource reservations
REDIS_MEMORY_RESERVATION=256M
REDIS_CPU_RESERVATION=0.25

# MinIO resource reservations
MINIO_MEMORY_RESERVATION=512M
MINIO_CPU_RESERVATION=0.5

# ==============================================
# Optional: Hard Limits (Uncomment to Cap Usage)
# ==============================================
# To prevent containers from using too much resource,
# uncomment and add these to your docker-compose.yml:
# 
# STALWART_MEMORY_LIMIT=4G
# STALWART_CPU_LIMIT=4
# POSTGRES_MEMORY_LIMIT=2G
# REDIS_MEMORY_LIMIT=1G
# MINIO_MEMORY_LIMIT=2G

# ==============================================
# SETUP INSTRUCTIONS
# ==============================================
#
# 1. GENERATE SECURE PASSWORDS
#    Run these commands to generate secure passwords:
#    openssl rand -base64 32  # Run 4 times for each password
#
# 2. CONFIGURE YOUR DOMAINS
#    Replace <YOUR_MAIL_DOMAIN> with your mail domain (e.g., mail.yourdomain.com)
#    Replace <YOUR_ADMIN_DOMAIN> with your admin domain (e.g., admin.yourdomain.com)
#
# 3. SETUP DNS RECORDS
#    Create A records for both domains pointing to your server IP:
#    mail.yourdomain.com      A      YOUR_SERVER_IP
#    admin.yourdomain.com     A      YOUR_SERVER_IP
#    yourdomain.com           MX 10  mail.yourdomain.com
#
# 4. SETUP NGINX TLS (for admin domain)
#    See nginx/README.md for complete instructions
#    
#    Quick setup with certbot:
#    mkdir -p nginx/webroot
#    sudo certbot certonly --webroot -w ./nginx/webroot -d admin.yourdomain.com
#    
#    Or use manual certificates:
#    mkdir -p nginx/certs
#    cp your-cert.pem nginx/certs/admin.yourdomain.com.crt
#    cp your-key.pem nginx/certs/admin.yourdomain.com.key
#
# 5. UPDATE NGINX CONFIG
#    Edit nginx/conf.d/admin.conf:
#    - Replace admin.example.com with your admin domain
#    - Update certificate paths if using certbot
#
# 6. SECURE THIS FILE
#    chmod 600 .env
#
# 7. DEPLOY
#    docker compose -f docker-compose.advanced.yml up -d --build
#
# 8. CONFIGURE MAIL TLS (Stalwart's built-in ACME)
#    - Access: https://admin.yourdomain.com
#    - Login: admin / YOUR_ADMIN_SECRET
#    - Go to: Settings → TLS → ACME
#    - Enable ACME for mail.yourdomain.com
#    - Stalwart will automatically obtain and renew certificates
#
# ==============================================
# DEPLOYMENT SIZE RECOMMENDATIONS
# ==============================================
# Adjust resource reservations based on deployment size:
#
# Small (< 1,000 users):
#   STALWART_MEMORY_RESERVATION=512M
#   STALWART_CPU_RESERVATION=0.5
#   POSTGRES_MEMORY_RESERVATION=256M
#   REDIS_MEMORY_RESERVATION=128M
#
# Medium (1,000-5,000 users):
#   STALWART_MEMORY_RESERVATION=2G
#   STALWART_CPU_RESERVATION=2
#   POSTGRES_MEMORY_RESERVATION=1G
#   REDIS_MEMORY_RESERVATION=512M
#
# Large (5,000-10,000 users):
#   STALWART_MEMORY_RESERVATION=4G
#   STALWART_CPU_RESERVATION=4
#   POSTGRES_MEMORY_RESERVATION=2G
#   REDIS_MEMORY_RESERVATION=1G
#
# Enterprise (10,000+ users):
#   See SCALING_GUIDE.md for horizontal scaling strategies
#
# ==============================================
# SECURITY CHECKLIST
# ==============================================
# Before going to production:
# ✓ Generate strong random passwords (openssl rand -base64 32)
# ✓ Use different passwords for each service
# ✓ Set file permissions: chmod 600 .env
# ✓ Verify .env is in .gitignore (never commit passwords!)
# ✓ Configure DNS records for both domains
# ✓ Setup TLS certificates for admin domain (certbot or manual)
# ✓ Enable Stalwart ACME for mail domain (via admin dashboard)
# ✓ Configure firewall (allow ports 80, 443, 25, 587, 465, 143, 993, 110, 995, 4190)
# ✓ Setup backup strategy for PostgreSQL and configuration
# ✓ Configure monitoring and alerting
# ✓ Test email sending and receiving
# ✓ Test admin panel access via HTTPS
# ✓ Verify TLS certificates are valid
# ✓ Review security logs regularly
#
# ==============================================
# PORTS REFERENCE
# ==============================================
# External ports (accessible from internet):
#   80    - HTTP (nginx - redirects to HTTPS)
#   443   - HTTPS (nginx - admin panel)
#   25    - SMTP (Stalwart - incoming mail)
#   587   - Submission (Stalwart - authenticated sending)
#   465   - Submissions (Stalwart - SMTP over TLS)
#   143   - IMAP (Stalwart - email access)
#   993   - IMAPS (Stalwart - IMAP over TLS)
#   110   - POP3 (Stalwart - email access)
#   995   - POP3S (Stalwart - POP3 over TLS)
#   4190  - ManageSieve (Stalwart - filter management)
#
# Internal ports (localhost only):
#   8080  - Stalwart admin (accessed via nginx)
#   9001  - MinIO console
#
# ==============================================
# TROUBLESHOOTING
# ==============================================
# 
# View service logs:
#   docker compose -f docker-compose.advanced.yml logs SERVICE_NAME
#
# Check all services:
#   docker compose -f docker-compose.advanced.yml ps
#
# Test nginx config:
#   docker compose exec nginx nginx -t
#
# Restart service:
#   docker compose -f docker-compose.advanced.yml restart SERVICE_NAME
#
# ==============================================
# DOCUMENTATION
# ==============================================
# Complete setup guides:
#   - MULTI_SERVICE_SETUP.md - Comprehensive deployment guide
#   - nginx/README.md - nginx configuration and certificate setup
#   - CHANGES_SUMMARY.md - Architecture and recent changes
#
# Official documentation:
#   https://stalw.art/docs
#
# ==============================================
# SECURITY NOTES
# ==============================================
# 1. NEVER commit this file with real passwords to version control
# 2. Use strong, randomly generated passwords for production
# 3. Consider using a secrets management system (Vault, AWS Secrets Manager)
# 4. Rotate passwords regularly (at least every 90 days)
# 5. Restrict file permissions: chmod 600 .env
# 6. Use different passwords for each service
# 7. Monitor access logs for suspicious activity
# 8. Keep software updated (docker images, host OS, certificates)
# 9. Setup automated backups
# 10. Test disaster recovery procedures
#
# Generate secure passwords with:
# openssl rand -base64 32
# or
# pwgen -s 32 1
# ==============================================
